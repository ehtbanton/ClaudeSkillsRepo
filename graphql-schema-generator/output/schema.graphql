# ===========================================
# GraphQL Schema: E-commerce API
# ===========================================

# Scalars
scalar DateTime
scalar UUID
scalar Decimal

# ===========================================
# Enums
# ===========================================

enum UserRole {
  CUSTOMER
  ADMIN
  MODERATOR
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
  REFUNDED
}

enum SortOrder {
  ASC
  DESC
}

# ===========================================
# Types
# ===========================================

type User {
  id: UUID!
  email: String!
  firstName: String!
  lastName: String!
  fullName: String!
  phone: String
  avatarUrl: String
  role: UserRole!
  status: UserStatus!
  orders: [Order!]!
  reviews: [Review!]!
  createdAt: DateTime!
  updatedAt: DateTime!
}

type Product {
  id: UUID!
  sku: String!
  name: String!
  slug: String!
  description: String
  price: Decimal!
  compareAtPrice: Decimal
  quantity: Int!
  isActive: Boolean!
  isFeatured: Boolean!
  categories: [Category!]!
  images: [ProductImage!]!
  reviews: [Review!]!
  averageRating: Float
  reviewCount: Int!
  createdAt: DateTime!
  updatedAt: DateTime!
}

type ProductImage {
  id: UUID!
  url: String!
  altText: String
  sortOrder: Int!
  isPrimary: Boolean!
}

type Category {
  id: UUID!
  name: String!
  slug: String!
  description: String
  imageUrl: String
  parent: Category
  children: [Category!]!
  products(first: Int, after: String): ProductConnection!
  isActive: Boolean!
}

type Order {
  id: UUID!
  orderNumber: String!
  user: User
  status: OrderStatus!
  paymentStatus: PaymentStatus!
  items: [OrderItem!]!
  subtotal: Decimal!
  tax: Decimal!
  shipping: Decimal!
  discount: Decimal!
  total: Decimal!
  shippingAddress: Address
  billingAddress: Address
  createdAt: DateTime!
  updatedAt: DateTime!
}

type OrderItem {
  id: UUID!
  product: Product
  sku: String!
  name: String!
  quantity: Int!
  unitPrice: Decimal!
  total: Decimal!
}

type Address {
  firstName: String!
  lastName: String!
  line1: String!
  line2: String
  city: String!
  state: String
  postalCode: String!
  country: String!
  phone: String
}

type Review {
  id: UUID!
  product: Product!
  user: User!
  rating: Int!
  title: String
  content: String
  isVerified: Boolean!
  createdAt: DateTime!
}

type Cart {
  id: UUID!
  items: [CartItem!]!
  subtotal: Decimal!
  itemCount: Int!
}

type CartItem {
  id: UUID!
  product: Product!
  quantity: Int!
  total: Decimal!
}

# ===========================================
# Connections (Pagination)
# ===========================================

type ProductConnection {
  edges: [ProductEdge!]!
  pageInfo: PageInfo!
  totalCount: Int!
}

type ProductEdge {
  cursor: String!
  node: Product!
}

type PageInfo {
  hasNextPage: Boolean!
  hasPreviousPage: Boolean!
  startCursor: String
  endCursor: String
}

# ===========================================
# Inputs
# ===========================================

input RegisterInput {
  email: String!
  password: String!
  firstName: String!
  lastName: String!
}

input LoginInput {
  email: String!
  password: String!
}

input UpdateUserInput {
  firstName: String
  lastName: String
  phone: String
  avatarUrl: String
}

input ProductFilterInput {
  categoryId: UUID
  minPrice: Decimal
  maxPrice: Decimal
  isActive: Boolean
  isFeatured: Boolean
  search: String
}

input ProductSortInput {
  field: ProductSortField!
  order: SortOrder!
}

enum ProductSortField {
  NAME
  PRICE
  CREATED_AT
  RATING
}

input AddToCartInput {
  productId: UUID!
  quantity: Int!
}

input CreateOrderInput {
  shippingAddress: AddressInput!
  billingAddress: AddressInput
}

input AddressInput {
  firstName: String!
  lastName: String!
  line1: String!
  line2: String
  city: String!
  state: String
  postalCode: String!
  country: String!
  phone: String
}

input CreateReviewInput {
  productId: UUID!
  rating: Int!
  title: String
  content: String
}

# ===========================================
# Payloads
# ===========================================

type AuthPayload {
  user: User!
  accessToken: String!
  refreshToken: String!
}

# ===========================================
# Queries
# ===========================================

type Query {
  # User queries
  me: User
  user(id: UUID!): User
  users(first: Int, after: String, role: UserRole, status: UserStatus): [User!]!

  # Product queries
  product(id: UUID, slug: String): Product
  products(
    first: Int
    after: String
    filter: ProductFilterInput
    sort: ProductSortInput
  ): ProductConnection!
  featuredProducts(first: Int): [Product!]!

  # Category queries
  category(id: UUID, slug: String): Category
  categories(parentId: UUID): [Category!]!
  rootCategories: [Category!]!

  # Order queries
  order(id: UUID!): Order
  myOrders(first: Int, after: String, status: OrderStatus): [Order!]!

  # Cart queries
  cart: Cart

  # Search
  search(query: String!, first: Int): ProductConnection!
}

# ===========================================
# Mutations
# ===========================================

type Mutation {
  # Auth mutations
  register(input: RegisterInput!): AuthPayload!
  login(input: LoginInput!): AuthPayload!
  logout: Boolean!
  refreshToken(refreshToken: String!): AuthPayload!

  # User mutations
  updateProfile(input: UpdateUserInput!): User!
  changePassword(currentPassword: String!, newPassword: String!): Boolean!

  # Cart mutations
  addToCart(input: AddToCartInput!): Cart!
  updateCartItem(itemId: UUID!, quantity: Int!): Cart!
  removeFromCart(itemId: UUID!): Cart!
  clearCart: Cart!

  # Order mutations
  createOrder(input: CreateOrderInput!): Order!
  cancelOrder(orderId: UUID!): Order!

  # Review mutations
  createReview(input: CreateReviewInput!): Review!
  deleteReview(id: UUID!): Boolean!
}

# ===========================================
# Subscriptions
# ===========================================

type Subscription {
  orderStatusChanged(orderId: UUID!): Order!
  newReview(productId: UUID!): Review!
}
