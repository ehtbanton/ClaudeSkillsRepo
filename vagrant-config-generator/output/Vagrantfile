# -*- mode: ruby -*-
# vi: set ft=ruby :

Vagrant.configure("2") do |config|
  config.vm.box = "ubuntu/jammy64"
  config.vm.hostname = "dev-server"

  # Network configuration
  config.vm.network "forwarded_port", guest: 3000, host: 3000
  config.vm.network "forwarded_port", guest: 5432, host: 5432
  config.vm.network "forwarded_port", guest: 6379, host: 6379
  config.vm.network "private_network", ip: "192.168.56.10"

  # Synced folder
  config.vm.synced_folder ".", "/vagrant", type: "virtualbox"

  # Provider configuration
  config.vm.provider "virtualbox" do |vb|
    vb.name = "dev-server"
    vb.memory = "4096"
    vb.cpus = 2
  end

  # Provisioning
  config.vm.provision "shell", inline: <<-SHELL
    apt-get update
    apt-get install -y curl git build-essential

    # Install Node.js
    curl -fsSL https://deb.nodesource.com/setup_20.x | bash -
    apt-get install -y nodejs
    corepack enable pnpm

    # Install Docker
    curl -fsSL https://get.docker.com | bash -
    usermod -aG docker vagrant

    # Install PostgreSQL
    apt-get install -y postgresql postgresql-contrib
    sudo -u postgres createuser -s vagrant

    # Install Redis
    apt-get install -y redis-server
    systemctl enable redis-server
  SHELL
end
